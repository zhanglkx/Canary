# 浏览器缓存清除指南

## 🚨 重要：如果浏览器仍然报 CORS 错误

服务器端已经完全修复，但**浏览器缓存了旧的 JavaScript 文件**。请按照以下步骤清除缓存：

---

## 📱 **Chrome / Edge**

### 方法 1：硬刷新（最快）
1. 打开 http://8.159.144.140
2. 按 **Ctrl + Shift + R**（Windows）或 **Cmd + Shift + R**（Mac）
3. 页面会强制重新加载所有资源

### 方法 2：清除缓存（彻底）
1. 按 **F12** 打开开发者工具
2. 右键点击刷新按钮（地址栏旁边）
3. 选择 **"清空缓存并硬性重新加载"**

### 方法 3：完全清除（最彻底）
1. 按 **Ctrl + Shift + Delete**（Windows）或 **Cmd + Shift + Delete**（Mac）
2. 选择时间范围：**全部时间**
3. 勾选：
   - ✅ **浏览历史记录**
   - ✅ **缓存的图片和文件**
   - ✅ **Cookie 及其他网站数据**
4. 点击 **"清除数据"**
5. 重新打开 http://8.159.144.140

---

## 🍎 **Safari**

### 方法 1：硬刷新
1. 打开 http://8.159.144.140
2. 按 **Cmd + Option + R**

### 方法 2：完全清除
1. 菜单栏 → **Safari** → **偏好设置**
2. 点击 **"高级"** 标签
3. 勾选 **"在菜单栏中显示开发菜单"**
4. 菜单栏 → **开发** → **清空缓存**
5. 或者按 **Cmd + Option + E**
6. 重新打开 http://8.159.144.140

---

## 🦊 **Firefox**

### 方法 1：硬刷新
1. 打开 http://8.159.144.140
2. 按 **Ctrl + Shift + R**（Windows）或 **Cmd + Shift + R**（Mac）

### 方法 2：完全清除
1. 按 **Ctrl + Shift + Delete**（Windows）或 **Cmd + Shift + Delete**（Mac）
2. 选择时间范围：**全部**
3. 勾选：
   - ✅ **浏览和下载历史**
   - ✅ **Cookie**
   - ✅ **缓存**
4. 点击 **"立即清除"**
5. 重新打开 http://8.159.144.140

---

## ✅ **验证是否生效**

清除缓存后：

1. 打开 http://8.159.144.140/register
2. 打开浏览器开发者工具（F12）
3. 切换到 **Network（网络）** 标签
4. 填写注册表单并提交
5. 查看 GraphQL 请求：
   - ✅ **OPTIONS 请求**：应该返回 204
   - ✅ **POST 请求**：应该返回 200 和注册成功的数据
   - ❌ 如果还有 CORS 错误，请再次硬刷新（Ctrl/Cmd + Shift + R）

---

## 🔧 **如果还是不行**

### 尝试无痕/隐私模式
1. Chrome: **Ctrl + Shift + N**（Windows）或 **Cmd + Shift + N**（Mac）
2. Safari: **Cmd + Shift + N**
3. Firefox: **Ctrl + Shift + P**（Windows）或 **Cmd + Shift + P**（Mac）
4. 在无痕模式下打开 http://8.159.144.140

无痕模式不会使用缓存，所以一定能看到最新版本！

---

## 📊 **技术细节（给开发者）**

### 修复内容
- ✅ Apollo Client 配置添加 `credentials: 'include'`
- ✅ Apollo Client 配置添加 `fetchOptions: { mode: 'cors' }`
- ✅ Nginx 配置完整的 CORS 头部
- ✅ Nginx 使用 `proxy_hide_header` 防止双重 CORS 头部
- ✅ 所有 Docker 镜像已重新构建

### 缓存问题原因
Next.js 的静态资源（JavaScript 文件）设置了：
```
Cache-Control: max-age=31536000, public, immutable
```

这意味着浏览器会缓存这些文件 **1 年**。旧的 JavaScript 文件（没有 `credentials` 的版本）被缓存了，需要手动清除。

### 验证修复
在浏览器控制台运行：
```javascript
// 检查 fetch 请求是否包含 credentials
fetch('http://8.159.144.140/graphql', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ query: '{__typename}' }),
  credentials: 'include'
}).then(r => r.json()).then(console.log)
```

应该返回 `{data: {__typename: "Query"}}`，而不是 CORS 错误。

---

## 🎉 **完成后**

一旦缓存清除，您应该能够：
- ✅ 成功注册新用户
- ✅ 成功登录
- ✅ 访问所有功能（待办事项、分类、商店等）
- ✅ **不再有任何 CORS 错误！**
