# ğŸ” é˜¿é‡Œäº‘éƒ¨ç½²é—®é¢˜åˆ†æä¸è§£å†³æ–¹æ¡ˆ

## ğŸ“Š é—®é¢˜æ¦‚è§ˆ

éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°äº† **6 ä¸ªä¸»è¦é—®é¢˜**ï¼Œæ¶‰åŠä¾èµ–ç®¡ç†ã€ç½‘ç»œã€Docker å¹³å°å…¼å®¹æ€§å’Œæ•°æ®åº“é…ç½®ã€‚

---

## âŒ é—®é¢˜ 1: sqlite3 ç¼–è¯‘å¤±è´¥

### ğŸ”´ é”™è¯¯ç°è±¡
```
gyp ERR! find Python
gyp ERR! stack Error: Could not find any Python installation to use
.../sqlite3@5.1.7/node_modules/sqlite3 install: Failed
ELIFECYCLE Command failed with exit code 1
```

### ğŸ” æ ¹æœ¬åŸå› 
1. **ä¾èµ–å†²çª**ï¼šé¡¹ç›®ä½¿ç”¨ PostgreSQLï¼Œä½† `typeorm` å°† `sqlite3` ä½œä¸º**å¯é€‰ä¾èµ–**
2. **ç¼–è¯‘ç¯å¢ƒç¼ºå¤±**ï¼šAlpine Linux Docker é•œåƒç¼ºå°‘ï¼š
   - Pythonï¼ˆnode-gyp éœ€è¦ï¼‰
   - ç¼–è¯‘å·¥å…·ï¼ˆgcc, g++, makeï¼‰
   - æ„å»ºä¾èµ–ï¼ˆbuild-baseï¼‰

### âœ… è§£å†³æ–¹æ¡ˆ
#### æ–¹æ¡ˆ 1: ä» package.json ç§»é™¤ sqlite3ï¼ˆå·²é‡‡ç”¨ï¼‰
```bash
# ä» apps/api/package.json åˆ é™¤ï¼š
- "@types/sqlite3": "^5.1.0"
- "sqlite3": "^5.1.7"

# æ›´æ–° lockfile
pnpm install
```

#### æ–¹æ¡ˆ 2: åœ¨ Dockerfile ä¸­ä½¿ç”¨ --no-optional
```dockerfile
# è·³è¿‡æ‰€æœ‰å¯é€‰ä¾èµ–
RUN pnpm install --frozen-lockfile --no-optional
```

### ğŸ“ ä¸ºä»€ä¹ˆæ–¹æ¡ˆ 1 æ›´å¥½ï¼Ÿ
- âœ… å½»åº•ç§»é™¤ä¸éœ€è¦çš„ä¾èµ–
- âœ… å‡å°é•œåƒä½“ç§¯
- âœ… é¿å…æœªæ¥ç±»ä¼¼é—®é¢˜
- âœ… æ˜ç¡®é¡¹ç›®ä¾èµ–

---

## âŒ é—®é¢˜ 2: npm Registry ç½‘ç»œè¶…æ—¶

### ğŸ”´ é”™è¯¯ç°è±¡
```
ETIMEDOUT request to https://registry.npmjs.org/lucide-react/-/lucide-react-0.552.0.tgz failed
ERR_SOCKET_TIMEOUT
Connection timeout
```

### ğŸ” æ ¹æœ¬åŸå› 
1. **åœ°ç†ä½ç½®**ï¼šé˜¿é‡Œäº‘æœåŠ¡å™¨è®¿é—®å›½å¤– npm registry å»¶è¿Ÿé«˜
2. **ç½‘ç»œä¸ç¨³å®š**ï¼š
   - éƒ¨åˆ†åŒ…ä¸‹è½½æˆåŠŸ
   - éƒ¨åˆ†åŒ…è¶…æ—¶ï¼ˆéšæœºæ€§ï¼‰
   - å¤§åŒ…æ›´å®¹æ˜“è¶…æ—¶
3. **Docker æ„å»ºä¸Šä¸‹æ–‡**ï¼šåœ¨å®¹å™¨å†…ä¸‹è½½ï¼Œæ— æ³•ä½¿ç”¨ä¸»æœºç½‘ç»œé…ç½®

### âœ… è§£å†³æ–¹æ¡ˆ
#### åœ¨ Dockerfile ä¸­é…ç½®å›½å†…é•œåƒ
```dockerfile
FROM base AS dependencies
# é…ç½® npm é•œåƒï¼ˆåœ¨å®¹å™¨å†…ç”Ÿæ•ˆï¼‰
RUN echo "registry=https://registry.npmmirror.com" > /root/.npmrc
COPY package.json pnpm-workspace.yaml pnpm-lock.yaml ./
...
```

### âš ï¸ ä¸ºä»€ä¹ˆä¸åœ¨æœåŠ¡å™¨ä¸Šé…ç½® .npmrcï¼Ÿ
```bash
# âŒ è¿™æ ·ä¸ä¼šç”Ÿæ•ˆ
echo "registry=https://registry.npmmirror.com" > ~/.npmrc
docker compose build
```
**åŸå› **ï¼šDocker æ„å»ºä½¿ç”¨ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¸ä¼šç»§æ‰¿ä¸»æœºçš„ `.npmrc`

---

## âŒ é—®é¢˜ 3: æœ¬åœ°æ„å»ºå¤±è´¥ - åŸºç¡€é•œåƒç¼ºå¤±

### ğŸ”´ é”™è¯¯ç°è±¡
```
æ­¥éª¤ 2/4: ä¿å­˜é•œåƒä¸º tar æ–‡ä»¶...
Error response from daemon: reference does not exist
âœ“ é•œåƒå¤§å°: 20B  # æ–‡ä»¶å¤ªå°ï¼Œè¯´æ˜ä¿å­˜å¤±è´¥
```

### ğŸ” æ ¹æœ¬åŸå› 
```bash
docker save postgres:16-alpine nginx:alpine | gzip > docker-images.tar.gz
```
å°è¯•ä¿å­˜çš„é•œåƒä¸åœ¨æœ¬åœ° Docker ä¸­ï¼š
- `canary-api-prod:latest` âœ… åˆšæ„å»ºçš„
- `canary-web-prod:latest` âœ… åˆšæ„å»ºçš„
- `postgres:16-alpine` âŒ æœªæ‹‰å–
- `nginx:alpine` âŒ æœªæ‹‰å–

### âœ… è§£å†³æ–¹æ¡ˆ
```bash
# åœ¨æœ¬åœ°æ„å»ºè„šæœ¬ä¸­æ·»åŠ æ‹‰å–æ­¥éª¤
echo "æ­¥éª¤ 1/5: æ‹‰å–åŸºç¡€é•œåƒ..."
docker pull postgres:16-alpine
docker pull nginx:alpine

echo "æ­¥éª¤ 2/5: æœ¬åœ°æ„å»ºé•œåƒ..."
docker compose -f docker-compose.prod.yml build

# æ·»åŠ éªŒè¯é€»è¾‘
FILE_SIZE=$(ls -lh docker-images.tar.gz | awk '{print $5}')
if [ "${FILE_SIZE}" = "20B" ]; then
  echo "âŒ é”™è¯¯ï¼šé•œåƒæ–‡ä»¶å¤ªå°ï¼Œæ‰“åŒ…å¤±è´¥ï¼"
  exit 1
fi
```

### ğŸ“ ç»éªŒæ•™è®­
- âœ… æ€»æ˜¯éªŒè¯å…³é”®æ“ä½œçš„ç»“æœ
- âœ… ä¸è¦å‡è®¾ä¾èµ–å·²å­˜åœ¨
- âœ… æ·»åŠ é”™è¯¯æ£€æŸ¥å’Œæå‰é€€å‡º

---

## âŒ é—®é¢˜ 4: Docker å¹³å°ä¸åŒ¹é…

### ğŸ”´ é”™è¯¯ç°è±¡
```
postgres The requested image's platform (linux/arm64/v8) 
does not match the detected host platform (linux/amd64/v4)

Container canary-db-prod is unhealthy
Restarting (1) Less than a second ago
```

### ğŸ” æ ¹æœ¬åŸå› 
1. **æœ¬åœ°ç¯å¢ƒ**ï¼šMacBookï¼ˆApple Silicon, ARM64 æ¶æ„ï¼‰
2. **æœåŠ¡å™¨ç¯å¢ƒ**ï¼šé˜¿é‡Œäº‘ ECSï¼ˆx86_64, AMD64 æ¶æ„ï¼‰
3. **é•œåƒä¿å­˜**ï¼š
   ```bash
   # åœ¨ MacBook ä¸Š
   docker pull postgres:16-alpine  # æ‹‰å–çš„æ˜¯ arm64 ç‰ˆæœ¬
   docker save postgres:16-alpine  # ä¿å­˜çš„æ˜¯ arm64 é•œåƒ
   ```
4. **ä¸Šä¼ åé—®é¢˜**ï¼šæœåŠ¡å™¨åŠ è½½ arm64 é•œåƒï¼Œä½† CPU æ˜¯ amd64

### âœ… è§£å†³æ–¹æ¡ˆ
#### æ–¹æ¡ˆ A: åœ¨æœåŠ¡å™¨ä¸Šé‡æ–°æ‹‰å–ï¼ˆå·²é‡‡ç”¨ï¼‰
```bash
# åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
docker pull --platform linux/amd64 postgres:16-alpine
docker pull --platform linux/amd64 nginx:alpine
docker compose up -d  # ä½¿ç”¨æ­£ç¡®å¹³å°çš„é•œåƒ
```

#### æ–¹æ¡ˆ B: æœ¬åœ°æ„å»ºæ—¶æŒ‡å®šå¹³å°
```bash
# åœ¨æœ¬åœ° MacBook ä¸Š
docker pull --platform linux/amd64 postgres:16-alpine
docker pull --platform linux/amd64 nginx:alpine
docker save postgres:16-alpine nginx:alpine | gzip > docker-images.tar.gz
```

### ğŸ“ ä¸ºä»€ä¹ˆé€‰æ‹©æ–¹æ¡ˆ Aï¼Ÿ
- âœ… æ›´ç®€å•ï¼šç›´æ¥åœ¨ç›®æ ‡ç¯å¢ƒæ‹‰å–
- âœ… é€Ÿåº¦å¿«ï¼šæœåŠ¡å™¨åˆ° Docker Hub å¯èƒ½æ›´å¿«
- âœ… é¿å…è·¨å¹³å°é—®é¢˜

---

## âŒ é—®é¢˜ 5: PostgreSQL å¯†ç è®¤è¯å¤±è´¥

### ğŸ”´ é”™è¯¯ç°è±¡
```
error: password authentication failed for user "postgres"
Unable to connect to the database. Retrying (8)...
```

### ğŸ” æ ¹æœ¬åŸå› 
**æ•°æ®å·æŒä¹…åŒ–é—®é¢˜**ï¼š

1. **ç¬¬ä¸€æ¬¡éƒ¨ç½²**ï¼š
   ```bash
   # PostgreSQL ä½¿ç”¨å¯†ç ï¼šold_password
   docker compose up -d
   # æ•°æ®å­˜å‚¨åœ¨å·ï¼šcanary_postgres_prod_data
   ```

2. **ä¿®æ”¹å¯†ç å**ï¼š
   ```bash
   # .env.production ä¸­ä¿®æ”¹ä¸ºï¼šnew_password
   docker compose down
   docker compose up -d
   ```

3. **é—®é¢˜å‘ç”Ÿ**ï¼š
   ```
   API å®¹å™¨ï¼šä½¿ç”¨ new_password è¿æ¥
   PostgreSQLï¼šä½¿ç”¨å·ä¸­çš„ old_passwordï¼ˆæ•°æ®å·æœªåˆ é™¤ï¼‰
   ç»“æœï¼šè®¤è¯å¤±è´¥ âŒ
   ```

### ğŸ” æ·±å±‚åˆ†æ
```bash
# PostgreSQL åˆå§‹åŒ–é€»è¾‘
if [ -z "$(ls -A /var/lib/postgresql/data)" ]; then
  # æ•°æ®ç›®å½•ä¸ºç©º â†’ æ‰§è¡Œåˆå§‹åŒ–
  initdb
  åˆ›å»ºç”¨æˆ·å’Œå¯†ç ï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰
else
  # æ•°æ®ç›®å½•ä¸ä¸ºç©º â†’ è·³è¿‡åˆå§‹åŒ–
  ä½¿ç”¨ç°æœ‰æ•°æ®åº“
  å¿½ç•¥æ–°çš„å¯†ç ç¯å¢ƒå˜é‡ âŒ
fi
```

### âœ… è§£å†³æ–¹æ¡ˆ
```bash
# ä½¿ç”¨ -v å‚æ•°åˆ é™¤æ•°æ®å·
docker compose -f docker-compose.prod.yml \
  --env-file .env.production \
  down -v  # â† å…³é”®å‚æ•°

# é‡æ–°å¯åŠ¨ï¼ˆä¼šåˆ›å»ºæ–°å·å’Œæ–°å¯†ç ï¼‰
docker compose -f docker-compose.prod.yml \
  --env-file .env.production \
  up -d
```

### ğŸ“ ç»éªŒæ•™è®­
- âš ï¸ Docker å·ä¼šæŒä¹…åŒ–æ•°æ®ï¼Œå³ä½¿å®¹å™¨åˆ é™¤
- âš ï¸ PostgreSQL åˆå§‹åŒ–åªåœ¨é¦–æ¬¡è¿è¡Œæ—¶æ‰§è¡Œ
- âœ… ä¿®æ”¹å¯†ç å¿…é¡»åˆ é™¤æ•°æ®å·æˆ–æ‰‹åŠ¨æ›´æ”¹æ•°æ®åº“å¯†ç 
- âœ… å¼€å‘ç¯å¢ƒå¯ä»¥ä½¿ç”¨ `down -v`
- âš ï¸ ç”Ÿäº§ç¯å¢ƒéœ€è°¨æ…ï¼ˆä¼šä¸¢å¤±æ•°æ®ï¼‰

### ğŸ”§ ç”Ÿäº§ç¯å¢ƒæ­£ç¡®åšæ³•
```bash
# æ–¹æ¡ˆ 1: ä¸åˆ é™¤å·ï¼Œç›´æ¥ä¿®æ”¹æ•°æ®åº“å¯†ç 
docker exec canary-db-prod psql -U postgres -c \
  "ALTER USER postgres PASSWORD 'new_password';"

# æ–¹æ¡ˆ 2: å¤‡ä»½æ•°æ®ååˆ é™¤å·
docker exec canary-db-prod pg_dump -U postgres > backup.sql
docker compose down -v
docker compose up -d
docker exec -i canary-db-prod psql -U postgres < backup.sql
```

---

## âŒ é—®é¢˜ 6: Next.js swc åŒ…ä¸‹è½½è¶…æ—¶ï¼ˆæœåŠ¡å™¨æ„å»ºï¼‰

### ğŸ”´ é”™è¯¯ç°è±¡
```
Downloading swc package @next/swc-linux-x64-gnu... to /root/.cache/next-swc
unhandledRejection [TypeError: terminated] {
  [cause]: [Error: read ETIMEDOUT]
}
```

### ğŸ” æ ¹æœ¬åŸå› 
1. Next.js æ„å»ºæ—¶éœ€è¦ä¸‹è½½å¹³å°ç‰¹å®šçš„ swc äºŒè¿›åˆ¶åŒ…
2. åŒ…æ‰˜ç®¡åœ¨ GitHub Releasesï¼ˆå›½å†…è®¿é—®æ…¢ï¼‰
3. åœ¨æœåŠ¡å™¨ Docker å®¹å™¨å†…æ„å»ºï¼Œç½‘ç»œé™åˆ¶æ›´ä¸¥æ ¼

### âœ… è§£å†³æ–¹æ¡ˆ
**é‡‡ç”¨æœ¬åœ°æ„å»ºç­–ç•¥**ï¼š

```bash
# 1. åœ¨æœ¬åœ°ï¼ˆç½‘ç»œå¥½ï¼‰æ„å»ºå®Œæ•´é•œåƒ
docker compose -f docker-compose.prod.yml build

# 2. ä¿å­˜é•œåƒä¸ºæ–‡ä»¶
docker save canary-api-prod:latest canary-web-prod:latest | gzip > images.tar.gz

# 3. ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp images.tar.gz root@server:/opt/

# 4. åœ¨æœåŠ¡å™¨åŠ è½½é•œåƒ
docker load < images.tar.gz

# 5. ç›´æ¥å¯åŠ¨ï¼ˆä¸éœ€è¦æ„å»ºï¼‰
docker compose up -d
```

### ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **æœåŠ¡å™¨æ„å»º** | è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜<br>CI/CD å‹å¥½ | âŒ ç½‘ç»œä¾èµ–<br>âŒ æ„å»ºæ…¢<br>âŒ ç»å¸¸å¤±è´¥ | ç½‘ç»œç¯å¢ƒå¥½çš„æœåŠ¡å™¨ |
| **æœ¬åœ°æ„å»ºæ¨é€** | âœ… ç½‘ç»œç¨³å®š<br>âœ… é€Ÿåº¦å¿«<br>âœ… æˆåŠŸç‡ 100% | éœ€è¦æœ¬åœ° Docker | ç½‘ç»œç¯å¢ƒå·®çš„æœåŠ¡å™¨<br>**å½“å‰é‡‡ç”¨** âœ… |
| **CI æ„å»ºæ¨é€** | âœ… è‡ªåŠ¨åŒ–<br>âœ… ç½‘ç»œå¥½<br>âœ… ç‰ˆæœ¬æ§åˆ¶ | éœ€é…ç½® CI/CD | å›¢é˜Ÿåä½œ<br>è‡ªåŠ¨éƒ¨ç½² |

---

## ğŸ¯ æœ€ç»ˆè§£å†³æ–¹æ¡ˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœ¬åœ°å¼€å‘ç¯å¢ƒ (MacBook - ç½‘ç»œç¨³å®š)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. ä¿®æ”¹ä»£ç                                                    â”‚
â”‚  2. docker compose build (æœ¬åœ°æ„å»º)                           â”‚
â”‚     âœ… ä» npm æ·˜å®é•œåƒä¸‹è½½ä¾èµ–                                 â”‚
â”‚     âœ… ä¸‹è½½ Next.js swc åŒ…                                    â”‚
â”‚     âœ… è·³è¿‡ sqlite3 å¯é€‰ä¾èµ–                                   â”‚
â”‚  3. docker save â†’ æ‰“åŒ…é•œåƒ (288MB)                            â”‚
â”‚  4. scp â†’ ä¸Šä¼ åˆ°æœåŠ¡å™¨                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¿é‡Œäº‘æœåŠ¡å™¨ (ç½‘ç»œä¸ç¨³å®š)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. docker load (åŠ è½½é•œåƒ)                                    â”‚
â”‚  2. docker pull --platform amd64 åŸºç¡€é•œåƒ                     â”‚
â”‚  3. docker compose up -d (å¯åŠ¨æœåŠ¡)                           â”‚
â”‚     âœ… ä¸éœ€è¦æ„å»º                                              â”‚
â”‚     âœ… ä¸éœ€è¦ä¸‹è½½ npm åŒ…                                       â”‚
â”‚     âœ… ç›´æ¥è¿è¡Œ                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ å®Œæ•´ä¿®å¤æ¸…å•

### 1ï¸âƒ£ ä»£ç å±‚é¢
- [x] ä» `apps/api/package.json` åˆ é™¤ sqlite3
- [x] æ›´æ–° `pnpm-lock.yaml`
- [x] åœ¨ Dockerfile æ·»åŠ  `--no-optional`
- [x] åœ¨ Dockerfile é…ç½® npm é•œåƒ

### 2ï¸âƒ£ éƒ¨ç½²æµç¨‹
- [x] åˆ›å»º `local-build-push.sh` è„šæœ¬
- [x] æ·»åŠ é•œåƒæ‹‰å–æ­¥éª¤
- [x] æ·»åŠ é•œåƒéªŒè¯é€»è¾‘
- [x] æ·»åŠ æ–‡ä»¶å¤§å°æ£€æŸ¥

### 3ï¸âƒ£ æœåŠ¡å™¨é…ç½®
- [x] æ‹‰å–æ­£ç¡®å¹³å°çš„åŸºç¡€é•œåƒ
- [x] åˆ é™¤æ—§çš„æ•°æ®å·ï¼ˆè§£å†³å¯†ç é—®é¢˜ï¼‰
- [x] é…ç½® Docker é•œåƒåŠ é€Ÿï¼ˆå¯é€‰ï¼‰

### 4ï¸âƒ£ æ–‡æ¡£å’Œæ¸…ç†
- [x] åˆ›å»º `DEPLOYMENT_SOLUTION.md`
- [x] åˆ›å»º `DEPLOYMENT_ISSUES_RESOLUTION.md`
- [x] åˆ é™¤æ—§çš„è„šæœ¬å’Œæ–‡æ¡£
- [x] æ¸…ç† .tar.gz æ–‡ä»¶

---

## ğŸš€ å½“å‰éƒ¨ç½²çŠ¶æ€

### âœ… æˆåŠŸè¿è¡Œçš„æœåŠ¡
```bash
CONTAINER ID   IMAGE                COMMAND                  PORTS                      NAMES
dcf5c29c604f   nginx:alpine         "..."                    0.0.0.0:80->80/tcp         canary-nginx-prod
e91f506372aa   canary-web           "..."                    0.0.0.0:3000->3000/tcp     canary-web-prod
11097a82253e   canary-api           "..."                    0.0.0.0:4000->4000/tcp     canary-api-prod (healthy)
fd00959be7b3   postgres:16-alpine   "..."                    0.0.0.0:5432->5432/tcp     canary-db-prod (healthy)
```

### ğŸŒ è®¿é—®åœ°å€
- **ä¸»é¡µ**: http://8.159.144.140
- **GraphQL**: http://8.159.144.140/graphql
- **APIå¥åº·æ£€æŸ¥**: http://8.159.144.140/health

---

## ğŸ“š ç»éªŒæ€»ç»“

### âœ… æœ€ä½³å®è·µ
1. **ä¾èµ–ç®¡ç†**ï¼šåªåŒ…å«å¿…è¦ä¾èµ–ï¼Œé¿å…å¯é€‰ä¾èµ–é—®é¢˜
2. **ç½‘ç»œä¼˜åŒ–**ï¼šåœ¨ Dockerfile ä¸­é…ç½®é•œåƒæº
3. **æœ¬åœ°æ„å»º**ï¼šç½‘ç»œç¯å¢ƒå·®æ—¶é‡‡ç”¨æœ¬åœ°æ„å»ºæ¨é€
4. **å¹³å°ä¸€è‡´**ï¼šæ³¨æ„æœ¬åœ°å’ŒæœåŠ¡å™¨çš„ CPU æ¶æ„
5. **æ•°æ®æŒä¹…åŒ–**ï¼šäº†è§£ Docker å·çš„è¡Œä¸º
6. **é”™è¯¯æ£€æŸ¥**ï¼šæ¯ä¸ªå…³é”®æ­¥éª¤æ·»åŠ éªŒè¯

### âš ï¸ å¸¸è§é™·é˜±
1. âŒ åœ¨ä¸»æœºé…ç½® .npmrcï¼ŒæœŸæœ› Docker ç»§æ‰¿
2. âŒ è·¨å¹³å°ä¿å­˜é•œåƒä¸æŒ‡å®š --platform
3. âŒ ä¿®æ”¹ç¯å¢ƒå˜é‡ä¸åˆ é™¤æ•°æ®å·
4. âŒ å‡è®¾ä¾èµ–å·²å­˜åœ¨ï¼Œä¸åšéªŒè¯
5. âŒ åœ¨ç½‘ç»œå·®çš„ç¯å¢ƒå¼ºè¡ŒæœåŠ¡å™¨æ„å»º

### ğŸ“ å­¦åˆ°çš„æ•™è®­
1. **å…ˆæœ¬åœ°éªŒè¯**ï¼šæœ¬åœ°æˆåŠŸåå†éƒ¨ç½²
2. **å¢é‡è§£å†³**ï¼šä¸€æ¬¡è§£å†³ä¸€ä¸ªé—®é¢˜
3. **ä¿ç•™æ—¥å¿—**ï¼šè®°å½•æ¯ä¸ªé”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ
4. **è‡ªåŠ¨åŒ–è„šæœ¬**ï¼šå°†æˆåŠŸçš„æµç¨‹è„šæœ¬åŒ–
5. **æ–‡æ¡£å®Œå–„**ï¼šè¯¦ç»†è®°å½•é—®é¢˜å’Œæ–¹æ¡ˆ

---

## ğŸ”„ æœªæ¥ä¼˜åŒ–æ–¹å‘

### 1. CI/CD é›†æˆ
```yaml
# .github/workflows/deploy.yml
- name: Build images
  run: docker compose build
  
- name: Save images  
  run: docker save ... | gzip > images.tar.gz
  
- name: Upload to server
  run: scp images.tar.gz server:/opt/
  
- name: Deploy
  run: ssh server 'docker load && docker compose up -d'
```

### 2. é•œåƒä¼˜åŒ–
- [ ] ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå‡å°é•œåƒå¤§å°
- [ ] é‡‡ç”¨ Docker æ„å»ºç¼“å­˜
- [ ] ä½¿ç”¨ .dockerignore æ’é™¤ä¸å¿…è¦æ–‡ä»¶

### 3. ç›‘æ§å‘Šè­¦
- [ ] æ·»åŠ å¥åº·æ£€æŸ¥ç«¯ç‚¹
- [ ] é…ç½®æ—¥å¿—æ”¶é›†
- [ ] è®¾ç½®æœåŠ¡ç›‘æ§

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2024-11-16  
**æœ€åæ›´æ–°**: 2024-11-16  
**éƒ¨ç½²çŠ¶æ€**: âœ… æˆåŠŸè¿è¡Œ  
**æ€»è€—æ—¶**: ~2 å°æ—¶ï¼ˆå«è°ƒè¯•ï¼‰
