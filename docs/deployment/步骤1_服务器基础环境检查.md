# 步骤 1：服务器基础环境检查

时间：2025-11-16  
执行人：我  
目标：检查服务器是否可以正常连接，了解当前系统状态

## 为什么要做这一步

在部署应用之前，需要：
1. 确认能正常连接到服务器
2. 了解服务器的操作系统类型和版本（不同系统的命令可能不同）
3. 检查系统资源（内存、磁盘）是否满足应用需求
4. 检查是否已经安装了 Docker 等必要工具

## 命令/操作

### 1. 连接到服务器
```bash
ssh -i ~/.ssh/aliyun_key.pem root@8.159.144.140
```

### 2. 查看系统信息
```bash
# 查看内核和系统架构
uname -a

# 查看操作系统发行版
cat /etc/os-release

# 查看系统版本（如果是 CentOS/RHEL）
cat /etc/redhat-release 2>/dev/null || echo "不是 RedHat 系列"
```

### 3. 检查系统资源
```bash
# 查看内存使用情况
free -h

# 查看磁盘使用情况
df -h

# 查看 CPU 信息
lscpu | grep -E "^CPU\(s\)|Model name"
```

### 4. 检查已安装的工具
```bash
# 检查 Docker
docker --version 2>/dev/null || echo "Docker 未安装"

# 检查 Docker Compose
docker-compose --version 2>/dev/null || echo "Docker Compose 未安装"

# 检查 Git
git --version 2>/dev/null || echo "Git 未安装"

# 检查 curl 和 wget
curl --version 2>/dev/null | head -1 || echo "curl 未安装"
wget --version 2>/dev/null | head -1 || echo "wget 未安装"
```

### 5. 检查网络和端口
```bash
# 检查公网 IP
curl -s ifconfig.me
echo ""

# 检查端口占用情况（我们需要 80, 443, 3000, 4000, 5432）
netstat -tulpn | grep -E ':(80|443|3000|4000|5432)\s' || echo "所需端口都未被占用"
```

## 预期结果

### 系统信息示例：
```
操作系统: Ubuntu 20.04 LTS 或 Alibaba Cloud Linux
内存: >= 2GB 可用
磁盘: >= 20GB 可用
架构: x86_64
```

### Docker 状态：
- 可能未安装（预期），下一步会安装
- 或已安装但未配置

### 网络：
- 公网 IP 显示为 8.159.144.140
- 端口 80, 443, 3000, 4000, 5432 未被占用

## 实际结果

### ✅ 系统信息
- **操作系统**: Alibaba Cloud Linux 3.2104 U12 (OpenAnolis Edition)
- **系统类型**: 基于 RHEL/CentOS（使用 dnf 包管理器）
- **内核版本**: Linux 5.10.134-19.1.al8.x86_64
- **架构**: x86_64
- **CPU**: 2核心 Intel(R) Xeon(R) Platinum

### ✅ 系统资源
- **内存**: 1.8GB 总内存，1.2GB 可用（满足需求）
- **磁盘**: 40GB 总空间，31GB 可用（充足）

### ⚠️ 已安装的工具
- **Docker**: ✅ 已安装（版本 26.1.3）
- **Docker Compose**: ❌ 未安装（需要安装）
- **Git**: ✅ 已安装（版本 2.43.7）
- **curl**: ✅ 已安装（版本 7.61.1）

### ⚠️ 端口占用情况
- **5432 端口**: 被 docker-proxy 占用（PostgreSQL 端口）
- **80, 443, 3000, 4000 端口**: 未被占用

### 🔍 发现的问题
1. **Docker overlay 文件系统存在**：说明之前运行过 Docker 容器
2. **端口 5432 被占用**：需要检查是否有旧的 PostgreSQL 容器在运行

## 碰到的问题

1. ⚠️ Docker Compose 未安装
2. ⚠️ 端口 5432 已被 docker-proxy 占用，可能有旧容器在运行

## 解决方式

需要在下一步中：
1. 先检查并清理旧的 Docker 容器
2. 安装 Docker Compose
3. 配置 Docker 镜像加速（阿里云）

## 下一步展望

1. 检查正在运行的 Docker 容器，清理旧容器和镜像
2. 安装 Docker Compose
3. 配置 Docker 镜像加速器（使用阿里云镜像源）
