# Canary é¡¹ç›®æ¶æ„åŸç†ä¸è¿è¡Œæœºåˆ¶

## ç›®å½•

1. [é¡¹ç›®æ•´ä½“æ¶æ„](#é¡¹ç›®æ•´ä½“æ¶æ„)
2. [å‰ç«¯æ¶æ„ (Next.js)](#å‰ç«¯æ¶æ„-nextjs)
3. [åç«¯æ¶æ„ (NestJS)](#åç«¯æ¶æ„-nestjs)
4. [å‰åç«¯é€šä¿¡æœºåˆ¶](#å‰åç«¯é€šä¿¡æœºåˆ¶)
5. [å®Œæ•´è¯·æ±‚æµç¨‹](#å®Œæ•´è¯·æ±‚æµç¨‹)
6. [æœ¬åœ°å¼€å‘æµç¨‹](#æœ¬åœ°å¼€å‘æµç¨‹)
7. [ç”Ÿäº§éƒ¨ç½²æµç¨‹](#ç”Ÿäº§éƒ¨ç½²æµç¨‹)

---

## é¡¹ç›®æ•´ä½“æ¶æ„

### æŠ€æœ¯æ ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Canary å…¨æ ˆåº”ç”¨                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   å‰ç«¯ (Web)      â”‚              â”‚   åç«¯ (API)      â”‚     â”‚
â”‚  â”‚                  â”‚              â”‚                  â”‚     â”‚
â”‚  â”‚  Next.js 15      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  NestJS 10       â”‚     â”‚
â”‚  â”‚  React 19        â”‚   GraphQL    â”‚  Apollo Server   â”‚     â”‚
â”‚  â”‚  Apollo Client   â”‚              â”‚  TypeORM         â”‚     â”‚
â”‚  â”‚  TailwindCSS     â”‚              â”‚  JWT Auth        â”‚     â”‚
â”‚  â”‚                  â”‚              â”‚                  â”‚     â”‚
â”‚  â”‚  Port: 3000      â”‚              â”‚  Port: 4000      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚           â”‚                                  â”‚               â”‚
â”‚           â”‚                                  â”‚               â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                          â–¼                                   â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                 â”‚   æ•°æ®åº“ (DB)     â”‚                         â”‚
â”‚                 â”‚                  â”‚                         â”‚
â”‚                 â”‚  PostgreSQL 16   â”‚                         â”‚
â”‚                 â”‚                  â”‚                         â”‚
â”‚                 â”‚  Port: 5432      â”‚                         â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Monorepo é¡¹ç›®ç»“æ„

```
Canary/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/              # Next.js å‰ç«¯åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ app/      # Next.js App Router (æ ¸å¿ƒ)
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/      # Apollo Client é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ graphql/  # GraphQL queries/mutations
â”‚   â”‚   â”œâ”€â”€ public/       # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ next.config.ts
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ api/              # NestJS åç«¯åº”ç”¨
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ main.ts   # åç«¯å…¥å£æ–‡ä»¶ (æ ¸å¿ƒ)
â”‚       â”‚   â”œâ”€â”€ app.module.ts
â”‚       â”‚   â”œâ”€â”€ auth/     # è®¤è¯æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ users/    # ç”¨æˆ·æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ posts/    # å¸–å­æ¨¡å—
â”‚       â”‚   â””â”€â”€ ...
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ libs/
â”‚   â””â”€â”€ shared/           # å…±äº«ä»£ç  (ç±»å‹å®šä¹‰ç­‰)
â”‚
â”œâ”€â”€ docker-compose.prod.yml
â”œâ”€â”€ nginx.prod.conf
â””â”€â”€ pnpm-workspace.yaml
```

---

## å‰ç«¯æ¶æ„ (Next.js)

### 1. **Next.js App Router (ä¸åŒäºä¼ ç»Ÿ SPA)**

#### âŒ ä¼ ç»Ÿ SPA æ¨¡å¼ (React)

```html
<!-- ä¼ ç»Ÿ SPA: index.html -->
<!DOCTYPE html>
<html>
  <head>
    <title>My App</title>
  </head>
  <body>
    <div id="root"></div>  <!-- React æŒ‚è½½ç‚¹ -->
    <script src="bundle.js"></script>
  </body>
</html>
```

```javascript
// ä¼ ç»Ÿ SPA: index.js
import ReactDOM from 'react-dom';
import App from './App';

// æŒ‚è½½åˆ° #root
ReactDOM.render(<App />, document.getElementById('root'));
```

**é—®é¢˜**ï¼š
- é¦–å±éœ€è¦ç­‰å¾… JavaScript åŠ è½½å®Œæˆ
- SEO ä¸å‹å¥½ï¼ˆæœç´¢å¼•æ“çœ‹ä¸åˆ°å†…å®¹ï¼‰
- é¦–æ¬¡åŠ è½½æ…¢

---

#### âœ… Next.js App Router æ¨¡å¼ (æœ¬é¡¹ç›®)

**Next.js ä½¿ç”¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ (SSR) + å®¢æˆ·ç«¯æ°´åˆ (Hydration)**

```
apps/web/src/app/
â”œâ”€â”€ layout.tsx          # æ ¹å¸ƒå±€ (ç›¸å½“äº HTML ç»“æ„)
â”œâ”€â”€ page.tsx            # é¦–é¡µ (/)
â”œâ”€â”€ register/
â”‚   â””â”€â”€ page.tsx        # æ³¨å†Œé¡µé¢ (/register)
â”œâ”€â”€ login/
â”‚   â””â”€â”€ page.tsx        # ç™»å½•é¡µé¢ (/login)
â””â”€â”€ dashboard/
    â””â”€â”€ page.tsx        # ä»ªè¡¨ç›˜ (/dashboard)
```

### 2. **Next.js å¯åŠ¨è¿‡ç¨‹**

#### ğŸ“ å…¥å£ç‚¹ï¼š`apps/web/src/app/layout.tsx`

```typescript
// apps/web/src/app/layout.tsx
// è¿™æ˜¯ Next.js çš„æ ¹å¸ƒå±€ï¼Œç›¸å½“äº HTML çš„ <html> å’Œ <body>
export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="zh-CN">
      <body>
        <ApolloWrapper>  {/* Apollo Client å…¨å±€é…ç½® */}
          {children}      {/* å­é¡µé¢å†…å®¹åœ¨è¿™é‡Œæ¸²æŸ“ */}
        </ApolloWrapper>
      </body>
    </html>
  );
}
```

#### ğŸ“ Apollo Client é…ç½®ï¼š`apps/web/src/lib/apollo-client.ts`

```typescript
// é…ç½® GraphQL å®¢æˆ·ç«¯
import { ApolloClient, InMemoryCache, createHttpLink } from '@apollo/client';

const httpLink = createHttpLink({
  // ä»ç¯å¢ƒå˜é‡è¯»å– API åœ°å€
  uri: process.env.NEXT_PUBLIC_API_URL || 'http://localhost:4000/graphql',
  credentials: 'include',  // æ”¯æŒè·¨åŸŸæºå¸¦ Cookie
  fetchOptions: {
    mode: 'cors',           // CORS æ¨¡å¼
  },
});

export const client = new ApolloClient({
  link: authLink.concat(httpLink),
  cache: new InMemoryCache(),  // å†…å­˜ç¼“å­˜
});
```

### 3. **å‰ç«¯é¡µé¢æ¸²æŸ“æµç¨‹**

```
ç”¨æˆ·è®¿é—® http://8.159.144.140/register
                â”‚
                â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Nginx (ç«¯å£ 80)     â”‚ åå‘ä»£ç†
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Next.js (ç«¯å£ 3000) â”‚ SSR æœåŠ¡å™¨
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    1. è¯»å– apps/web/src/app/register/page.tsx
    2. åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ HTML (SSR)
    3. è¿”å›å®Œæ•´çš„ HTML ç»™æµè§ˆå™¨
                â”‚
                â–¼
    æµè§ˆå™¨æ”¶åˆ° HTMLï¼Œç«‹å³æ˜¾ç¤ºé¡µé¢ (å¿«ï¼)
                â”‚
                â–¼
    4. ä¸‹è½½ JavaScript bundle
    5. React è¿›è¡Œ Hydration (æ¿€æ´»äº¤äº’)
                â”‚
                â–¼
    é¡µé¢å®Œå…¨å¯äº¤äº’ âœ…
```

**å…³é”®ç‚¹**ï¼š
- **æ²¡æœ‰ `<div id="root">`**ï¼šNext.js ç›´æ¥ç”Ÿæˆå®Œæ•´çš„ HTML
- **SSR (Server-Side Rendering)**ï¼šé¡µé¢åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“
- **Hydration**ï¼šJavaScript åŠ è½½åï¼ŒReact æ¥ç®¡é¡µé¢ï¼Œç»‘å®šäº‹ä»¶

---

## åç«¯æ¶æ„ (NestJS)

### 1. **åç«¯å…¥å£ï¼š`apps/api/src/main.ts`**

è¿™æ˜¯æ•´ä¸ªåç«¯åº”ç”¨çš„å¯åŠ¨æ–‡ä»¶ï¼š

```typescript
// apps/api/src/main.ts
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';

async function bootstrap() {
  // 1ï¸âƒ£ åˆ›å»º NestJS åº”ç”¨å®ä¾‹
  const app = await NestFactory.create(AppModule);

  // 2ï¸âƒ£ é…ç½® CORS (è·¨åŸŸèµ„æºå…±äº«)
  app.enableCors({
    origin: [
      process.env.FRONTEND_URL || 'http://localhost:3000',
      'http://8.159.144.140',  // ç”Ÿäº§ç¯å¢ƒ
    ],
    credentials: true,  // å…è®¸æºå¸¦ Cookie/Token
    methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
    allowedHeaders: ['Content-Type', 'Authorization', 'apollo-require-preflight'],
  });

  // 3ï¸âƒ£ å¯åŠ¨ HTTP æœåŠ¡å™¨ï¼Œç›‘å¬ 4000 ç«¯å£
  const port = process.env.PORT || 4000;
  await app.listen(port);
  
  console.log(`ğŸš€ Server is running on http://localhost:${port}/graphql`);
}

// 4ï¸âƒ£ æ‰§è¡Œå¯åŠ¨å‡½æ•°
bootstrap();
```

### 2. **åç«¯æ¨¡å—ç»“æ„ï¼š`apps/api/src/app.module.ts`**

```typescript
// apps/api/src/app.module.ts
import { Module } from '@nestjs/common';
import { GraphQLModule } from '@nestjs/graphql';
import { TypeOrmModule } from '@nestjs/typeorm';
import { ApolloDriver, ApolloDriverConfig } from '@nestjs/apollo';

@Module({
  imports: [
    // 1ï¸âƒ£ é…ç½® GraphQL
    GraphQLModule.forRoot<ApolloDriverConfig>({
      driver: ApolloDriver,
      autoSchemaFile: true,  // è‡ªåŠ¨ç”Ÿæˆ schema
      playground: true,      // å¯ç”¨ GraphQL Playground
      context: ({ req, res }) => ({ req, res }),  // ä¼ é€’ request/response
    }),

    // 2ï¸âƒ£ é…ç½®æ•°æ®åº“è¿æ¥
    TypeOrmModule.forRootAsync({
      useFactory: (configService: ConfigService) => ({
        type: 'postgres',
        host: configService.get('DATABASE_HOST', 'localhost'),
        port: configService.get('DATABASE_PORT', 5432),
        username: configService.get('DATABASE_USERNAME', 'postgres'),
        password: configService.get('DATABASE_PASSWORD'),
        database: configService.get('DATABASE_NAME', 'canary_production'),
        entities: [__dirname + '/**/*.entity{.ts,.js}'],
        synchronize: configService.get('TYPEORM_SYNCHRONIZE') === 'true',
      }),
      inject: [ConfigService],
    }),

    // 3ï¸âƒ£ ä¸šåŠ¡æ¨¡å—
    AuthModule,    // è®¤è¯æ¨¡å—
    UsersModule,   // ç”¨æˆ·æ¨¡å—
    PostsModule,   // å¸–å­æ¨¡å—
    // ...
  ],
})
export class AppModule {}
```

### 3. **GraphQL Resolver (å¤„ç†è¯·æ±‚)**

```typescript
// apps/api/src/auth/auth.resolver.ts
import { Resolver, Mutation, Args } from '@nestjs/graphql';
import { AuthService } from './auth.service';

@Resolver()
export class AuthResolver {
  constructor(private readonly authService: AuthService) {}

  // GraphQL Mutation: æ³¨å†Œç”¨æˆ·
  @Mutation(() => AuthPayload)
  async register(
    @Args('registerInput') registerInput: RegisterInput,
  ): Promise<AuthPayload> {
    return this.authService.register(registerInput);
  }

  // GraphQL Mutation: ç™»å½•
  @Mutation(() => AuthPayload)
  async login(
    @Args('loginInput') loginInput: LoginInput,
  ): Promise<AuthPayload> {
    return this.authService.login(loginInput);
  }
}
```

---

## å‰åç«¯é€šä¿¡æœºåˆ¶

### 1. **é€šä¿¡åè®®ï¼šGraphQL**

ä¸ä¼ ç»Ÿ REST API ä¸åŒï¼Œæœ¬é¡¹ç›®ä½¿ç”¨ GraphQLï¼š

#### REST API (ä¼ ç»Ÿ)

```
GET  /api/users       # è·å–æ‰€æœ‰ç”¨æˆ·
GET  /api/users/:id   # è·å–å•ä¸ªç”¨æˆ·
POST /api/users       # åˆ›å»ºç”¨æˆ·
PUT  /api/users/:id   # æ›´æ–°ç”¨æˆ·
DELETE /api/users/:id # åˆ é™¤ç”¨æˆ·
```

#### GraphQL (æœ¬é¡¹ç›®)

```
POST /graphql  # æ‰€æœ‰è¯·æ±‚éƒ½å‘åˆ°è¿™ä¸ªç«¯ç‚¹
```

**GraphQL Query ç¤ºä¾‹**ï¼š

```graphql
# æ³¨å†Œç”¨æˆ·
mutation Register($email: String!, $username: String!, $password: String!) {
  register(registerInput: {
    email: $email
    username: $username
    password: $password
  }) {
    accessToken
    user {
      id
      email
      username
    }
  }
}
```

### 2. **å‰ç«¯å‘èµ·è¯·æ±‚**

```typescript
// apps/web/src/app/register/page.tsx
import { useMutation } from '@apollo/client';
import { REGISTER_MUTATION } from '@/graphql/mutations';

export default function RegisterPage() {
  const [register, { loading, error }] = useMutation(REGISTER_MUTATION);

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    // å‘é€ GraphQL è¯·æ±‚åˆ°åç«¯
    const { data } = await register({
      variables: {
        email: formData.email,
        username: formData.username,
        password: formData.password,
      },
    });

    // ä¿å­˜ Token
    localStorage.setItem('token', data.register.accessToken);
  };

  return (
    <form onSubmit={handleSubmit}>
      {/* è¡¨å•å†…å®¹ */}
    </form>
  );
}
```

### 3. **åç«¯å¤„ç†è¯·æ±‚**

```typescript
// apps/api/src/auth/auth.service.ts
import { Injectable } from '@nestjs/common';
import { JwtService } from '@nestjs/jwt';
import * as bcrypt from 'bcrypt';

@Injectable()
export class AuthService {
  constructor(
    private usersService: UsersService,
    private jwtService: JwtService,
  ) {}

  async register(registerInput: RegisterInput): Promise<AuthPayload> {
    // 1ï¸âƒ£ æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
    const existingUser = await this.usersService.findByEmail(registerInput.email);
    if (existingUser) {
      throw new Error('ç”¨æˆ·å·²å­˜åœ¨');
    }

    // 2ï¸âƒ£ åŠ å¯†å¯†ç 
    const hashedPassword = await bcrypt.hash(registerInput.password, 10);

    // 3ï¸âƒ£ åˆ›å»ºç”¨æˆ·
    const user = await this.usersService.create({
      ...registerInput,
      password: hashedPassword,
    });

    // 4ï¸âƒ£ ç”Ÿæˆ JWT Token
    const accessToken = this.jwtService.sign({
      sub: user.id,
      email: user.email,
    });

    // 5ï¸âƒ£ è¿”å›ç»“æœ
    return {
      accessToken,
      user,
    };
  }
}
```

---

## å®Œæ•´è¯·æ±‚æµç¨‹

### åœºæ™¯ï¼šç”¨æˆ·æ³¨å†Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æµè§ˆå™¨     â”‚ 1. ç”¨æˆ·å¡«å†™æ³¨å†Œè¡¨å•ï¼Œç‚¹å‡»"åˆ›å»ºè´¦å·"
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. JavaScript æ‹¦æˆªè¡¨å•æäº¤
       â”‚    è°ƒç”¨ Apollo Client
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Apollo Client (apps/web/src/lib/apollo-client.ts)  â”‚
â”‚                                                       â”‚
â”‚  - æ·»åŠ  Authorization header (JWT Token)             â”‚
â”‚  - è®¾ç½® Content-Type: application/json               â”‚
â”‚  - è®¾ç½® Origin: http://8.159.144.140                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
       â”‚                                            â”‚
       â”‚ 3. POST http://8.159.144.140/graphql      â”‚
       â”‚    Body: {"query": "mutation Register...", â”‚
       â”‚           "variables": {...}}              â”‚
       â”‚                                            â”‚
       â–¼                                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  Nginx (ç«¯å£ 80)     â”‚ 4. æ£€æŸ¥ CORS                â”‚
â”‚                     â”‚    æ·»åŠ  CORS headers        â”‚
â”‚  - å¤„ç† OPTIONS     â”‚    éšè—åç«¯ CORS headers    â”‚
â”‚  - åå‘ä»£ç†         â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
       â”‚                                            â”‚
       â”‚ 5. è½¬å‘åˆ°åç«¯                              â”‚
       â”‚    proxy_pass http://api:4000/graphql     â”‚
       â”‚                                            â”‚
       â–¼                                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  NestJS (ç«¯å£ 4000)  â”‚ 6. CORS ä¸­é—´ä»¶æ£€æŸ¥          â”‚
â”‚                     â”‚    éªŒè¯ Origin              â”‚
â”‚  main.ts            â”‚                             â”‚
â”‚    â†“                â”‚                             â”‚
â”‚  GraphQL è§£æå™¨      â”‚ 7. è§£æ GraphQL query       â”‚
â”‚    â†“                â”‚    è·¯ç”±åˆ° AuthResolver      â”‚
â”‚  AuthResolver       â”‚                             â”‚
â”‚    â†“                â”‚                             â”‚
â”‚  AuthService        â”‚ 8. ä¸šåŠ¡é€»è¾‘å¤„ç†             â”‚
â”‚    â†“                â”‚    - éªŒè¯è¾“å…¥               â”‚
â”‚  UsersService       â”‚    - æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨        â”‚
â”‚    â†“                â”‚    - åŠ å¯†å¯†ç                â”‚
â”‚  TypeORM            â”‚    - ä¿å­˜åˆ°æ•°æ®åº“           â”‚
â”‚    â†“                â”‚    - ç”Ÿæˆ JWT Token         â”‚
â”‚  PostgreSQL         â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
       â”‚                                            â”‚
       â”‚ 9. è¿”å› JSON å“åº”                          â”‚
       â”‚    {                                       â”‚
       â”‚      "data": {                             â”‚
       â”‚        "register": {                       â”‚
       â”‚          "accessToken": "eyJhbG...",       â”‚
       â”‚          "user": {...}                     â”‚
       â”‚        }                                   â”‚
       â”‚      }                                     â”‚
       â”‚    }                                       â”‚
       â”‚                                            â”‚
       â–¼                                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  Nginx              â”‚ 10. æ·»åŠ  CORS headers       â”‚
â”‚                     â”‚     è¿”å›ç»™æµè§ˆå™¨            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
       â”‚                                            â”‚
       â–¼                                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  Apollo Client      â”‚ 11. è§£æå“åº”                â”‚
â”‚                     â”‚     æ›´æ–°ç¼“å­˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
       â”‚                                            â”‚
       â”‚ 12. è§¦å‘å›è°ƒå‡½æ•°                           â”‚
       â”‚     - ä¿å­˜ Token åˆ° localStorage           â”‚
       â”‚     - è·³è½¬åˆ° Dashboard                     â”‚
       â”‚                                            â”‚
       â–¼                                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚   æµè§ˆå™¨     â”‚ 13. æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ï¼Œè·³è½¬é¡µé¢          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
```

---

## æœ¬åœ°å¼€å‘æµç¨‹

### 1. **å¯åŠ¨å¼€å‘ç¯å¢ƒ**

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
cd /Users/zlk/Documents/Demo/nest/Canary

# 1ï¸âƒ£ å®‰è£…ä¾èµ–
pnpm install

# 2ï¸âƒ£ å¯åŠ¨æ•°æ®åº“ (Docker)
docker-compose up -d postgres

# 3ï¸âƒ£ å¯åŠ¨åç«¯ (ç»ˆç«¯ 1)
pnpm dev --filter @canary/api
# åç«¯å¯åŠ¨åœ¨ http://localhost:4000/graphql

# 4ï¸âƒ£ å¯åŠ¨å‰ç«¯ (ç»ˆç«¯ 2)
pnpm dev --filter @canary/web
# å‰ç«¯å¯åŠ¨åœ¨ http://localhost:3000
```

### 2. **å¼€å‘ç¯å¢ƒæ¶æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æœ¬åœ°å¼€å‘ç¯å¢ƒ (localhost)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  æµè§ˆå™¨è®¿é—®: http://localhost:3000               â”‚
â”‚         â”‚                                        â”‚
â”‚         â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  Next.js Dev     â”‚ â† Hot Reload (å®æ—¶åˆ·æ–°)    â”‚
â”‚  â”‚  (ç«¯å£ 3000)     â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚           â”‚                                      â”‚
â”‚           â”‚ GraphQL è¯·æ±‚                         â”‚
â”‚           â”‚ http://localhost:4000/graphql        â”‚
â”‚           â”‚                                      â”‚
â”‚           â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  NestJS Dev      â”‚ â† è‡ªåŠ¨é‡å¯ (ä»£ç æ”¹å˜æ—¶)    â”‚
â”‚  â”‚  (ç«¯å£ 4000)     â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚           â”‚                                      â”‚
â”‚           â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  PostgreSQL      â”‚                            â”‚
â”‚  â”‚  (ç«¯å£ 5432)     â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¼€å‘ç¯å¢ƒç‰¹ç‚¹**ï¼š
- âœ… Hot Reloadï¼šä¿®æ”¹ä»£ç ç«‹å³ç”Ÿæ•ˆ
- âœ… æºç æ˜ å°„ï¼šé”™è¯¯å †æ ˆæŒ‡å‘æºä»£ç 
- âœ… è°ƒè¯•å‹å¥½ï¼šå¯ä»¥ä½¿ç”¨æµè§ˆå™¨ DevTools
- âœ… GraphQL Playgroundï¼šhttp://localhost:4000/graphql

---

## ç”Ÿäº§éƒ¨ç½²æµç¨‹

### 1. **Docker æ„å»º**

```bash
# åœ¨æœåŠ¡å™¨ä¸Š
cd /root/canary

# 1ï¸âƒ£ æ„å»ºé•œåƒ
docker-compose -f docker-compose.prod.yml build

# 2ï¸âƒ£ å¯åŠ¨æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d
```

### 2. **ç”Ÿäº§ç¯å¢ƒæ¶æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç”Ÿäº§ç¯å¢ƒ (8.159.144.140)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ç”¨æˆ·è®¿é—®: http://8.159.144.140                             â”‚
â”‚         â”‚                                                    â”‚
â”‚         â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚  Nginx (ç«¯å£ 80)          â”‚ â† åå‘ä»£ç† + é™æ€æ–‡ä»¶æœåŠ¡      â”‚
â”‚  â”‚                          â”‚                               â”‚
â”‚  â”‚  - / â†’ Next.js (3000)    â”‚                               â”‚
â”‚  â”‚  - /graphql â†’ API (4000) â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚       â”‚              â”‚                                       â”‚
â”‚       â”‚              â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  Next.js      â”‚  â”‚  NestJS API     â”‚                     â”‚
â”‚  â”‚  (å®¹å™¨)       â”‚  â”‚  (å®¹å™¨)         â”‚                     â”‚
â”‚  â”‚  ç«¯å£: 3000   â”‚  â”‚  ç«¯å£: 4000     â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                              â”‚                               â”‚
â”‚                              â–¼                               â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                     â”‚  PostgreSQL    â”‚                       â”‚
â”‚                     â”‚  (å®¹å™¨)        â”‚                       â”‚
â”‚                     â”‚  ç«¯å£: 5432    â”‚                       â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                              â”‚
â”‚  Docker Network: canary-network                             â”‚
â”‚  - å®¹å™¨ä¹‹é—´é€šè¿‡å®¹å™¨åé€šä¿¡ (å¦‚ api, web, postgres)            â”‚
â”‚  - æ— éœ€æš´éœ²æ‰€æœ‰ç«¯å£åˆ°å®¿ä¸»æœº                                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. **Nginx é…ç½®è¯¦è§£**

```nginx
# nginx.prod.conf
server {
    listen 80;
    server_name 8.159.144.140;

    # 1ï¸âƒ£ GraphQL API è¯·æ±‚ (åç«¯)
    location /graphql {
        # CORS é¢„æ£€è¯·æ±‚å¤„ç†
        if ($request_method = 'OPTIONS') {
            add_header 'Access-Control-Allow-Origin' '$http_origin' always;
            add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
            add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization' always;
            add_header 'Access-Control-Allow-Credentials' 'true' always;
            return 204;
        }

        # ä»£ç†åˆ°åç«¯ API å®¹å™¨
        proxy_pass http://api:4000/graphql;
        
        # ä¼ é€’åŸå§‹è¯·æ±‚å¤´
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header Origin $http_origin;
        
        # éšè—åç«¯çš„ CORS headers (é¿å…é‡å¤)
        proxy_hide_header 'Access-Control-Allow-Origin';
        proxy_hide_header 'Access-Control-Allow-Methods';
        
        # æ·»åŠ  Nginx çš„ CORS headers
        add_header 'Access-Control-Allow-Origin' '$http_origin' always;
        add_header 'Access-Control-Allow-Credentials' 'true' always;
    }

    # 2ï¸âƒ£ å‰ç«¯é¡µé¢è¯·æ±‚ (Next.js)
    location / {
        proxy_pass http://web:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### 4. **Docker Compose ç¼–æ’**

```yaml
# docker-compose.prod.yml
version: '3.8'

services:
  # 1ï¸âƒ£ PostgreSQL æ•°æ®åº“
  postgres:
    image: postgres:16-alpine
    container_name: canary-db-prod
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${DATABASE_PASSWORD}
      POSTGRES_DB: canary_production
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - canary-network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5

  # 2ï¸âƒ£ NestJS API
  api:
    build:
      context: .
      dockerfile: apps/api/Dockerfile
    image: canary-api-prod:latest
    container_name: canary-api-prod
    env_file:
      - .env.production
    environment:
      DATABASE_HOST: postgres  # â† å®¹å™¨å
      API_PORT: 4000
    ports:
      - '4000:4000'
    depends_on:
      postgres:
        condition: service_healthy
    networks:
      - canary-network

  # 3ï¸âƒ£ Next.js Web
  web:
    build:
      context: .
      dockerfile: apps/web/Dockerfile
      args:
        NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL}  # â† æ„å»ºæ—¶æ³¨å…¥
    image: canary-web-prod:latest
    container_name: canary-web-prod
    env_file:
      - .env.production
    environment:
      NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL}
    ports:
      - '3000:3000'
    depends_on:
      - api
    networks:
      - canary-network

  # 4ï¸âƒ£ Nginx åå‘ä»£ç†
  nginx:
    image: nginx:alpine
    container_name: canary-nginx-prod
    volumes:
      - ./nginx.prod.conf:/etc/nginx/conf.d/default.conf:ro
    ports:
      - '80:80'
    depends_on:
      - web
      - api
    networks:
      - canary-network

networks:
  canary-network:
    driver: bridge

volumes:
  postgres_data:
```

---

## å…³é”®æŠ€æœ¯ç‚¹æ€»ç»“

### 1. **Next.js ä¸åŒäºä¼ ç»Ÿ SPA**

| ç‰¹æ€§ | ä¼ ç»Ÿ SPA (React) | Next.js (æœ¬é¡¹ç›®) |
|------|------------------|------------------|
| æ¸²æŸ“æ–¹å¼ | å®¢æˆ·ç«¯æ¸²æŸ“ (CSR) | æœåŠ¡å™¨ç«¯æ¸²æŸ“ (SSR) + Hydration |
| å…¥å£æ–‡ä»¶ | `index.html` + `ReactDOM.render()` | `app/layout.tsx` + `app/page.tsx` |
| é¦–å±é€Ÿåº¦ | æ…¢ (éœ€ç­‰å¾… JS) | å¿« (HTML ç›´æ¥æ¸²æŸ“) |
| SEO | å·® | ä¼˜ç§€ |
| è·¯ç”± | React Router (å®¢æˆ·ç«¯) | æ–‡ä»¶ç³»ç»Ÿè·¯ç”± (æœåŠ¡å™¨ç«¯) |

### 2. **GraphQL vs REST**

| ç‰¹æ€§ | REST API | GraphQL |
|------|----------|---------|
| ç«¯ç‚¹ | å¤šä¸ª (`/users`, `/posts`) | å•ä¸ª (`/graphql`) |
| è¯·æ±‚æ–¹æ³• | GET, POST, PUT, DELETE | åªç”¨ POST |
| æ•°æ®è·å– | å›ºå®šç»“æ„ (over-fetching) | æŒ‰éœ€è·å– (ç²¾ç¡®) |
| ç±»å‹ç³»ç»Ÿ | æ—  (éœ€è¦æ–‡æ¡£) | å¼ºç±»å‹ (è‡ªåŠ¨ç”Ÿæˆ) |

### 3. **Docker ç½‘ç»œé€šä¿¡**

```bash
# å®¹å™¨å†…éƒ¨é€šä¿¡ï¼ˆé€šè¿‡å®¹å™¨åï¼‰
http://api:4000/graphql      # web å®¹å™¨è®¿é—® api å®¹å™¨
http://postgres:5432          # api å®¹å™¨è®¿é—®æ•°æ®åº“

# å¤–éƒ¨è®¿é—®ï¼ˆé€šè¿‡å®¿ä¸»æœº IPï¼‰
http://8.159.144.140          # ç”¨æˆ·è®¿é—® Nginx
http://8.159.144.140/graphql  # ç”¨æˆ·è®¿é—® API
```

### 4. **ç¯å¢ƒå˜é‡æ³¨å…¥**

```bash
# å‰ç«¯ç¯å¢ƒå˜é‡ (å¿…é¡»ä»¥ NEXT_PUBLIC_ å¼€å¤´)
NEXT_PUBLIC_API_URL=http://8.159.144.140/graphql  # â† å¯åœ¨æµè§ˆå™¨ä¸­è®¿é—®

# åç«¯ç¯å¢ƒå˜é‡
DATABASE_HOST=postgres  # â† åªåœ¨æœåŠ¡å™¨ç«¯å¯è§
DATABASE_PASSWORD=xxx   # â† å®‰å…¨ï¼Œä¸ä¼šæš´éœ²ç»™æµè§ˆå™¨
JWT_SECRET=xxx
```

**é‡è¦**ï¼šNext.js çš„ `NEXT_PUBLIC_*` å˜é‡ä¼šåœ¨**æ„å»ºæ—¶**è¢«æ‰“åŒ…åˆ° JavaScript ä¸­ï¼š

```typescript
// æ„å»ºæ—¶
const apiUrl = process.env.NEXT_PUBLIC_API_URL;

// ç¼–è¯‘å (æ‰“åŒ…åˆ° bundle.js)
const apiUrl = "http://8.159.144.140/graphql";
```

---

## æ€»ç»“

### å®Œæ•´æµç¨‹å›¾

```
ç”¨æˆ·æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® http://8.159.144.140/register
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Nginx (80)   â”‚ åå‘ä»£ç†
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
          åˆ¤æ–­ URL è·¯å¾„
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
    /graphql                    / (å…¶ä»–è·¯å¾„)
        â”‚                       â”‚
        â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NestJS API   â”‚        â”‚  Next.js     â”‚
â”‚ (4000)       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”‚  (3000)      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ GraphQLâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚          è¯·æ±‚
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚
â”‚ (5432)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè¦ç‚¹

1. **å‰ç«¯ (Next.js)**ï¼š
   - å…¥å£ï¼š`apps/web/src/app/layout.tsx` å’Œ `page.tsx`
   - ä¸æ˜¯ä¼ ç»Ÿ SPAï¼Œä½¿ç”¨ SSR + Hydration
   - é€šè¿‡ Apollo Client å‘é€ GraphQL è¯·æ±‚

2. **åç«¯ (NestJS)**ï¼š
   - å…¥å£ï¼š`apps/api/src/main.ts` â†’ `bootstrap()` å‡½æ•°
   - ç›‘å¬ 4000 ç«¯å£ï¼Œæä¾› GraphQL API
   - ä½¿ç”¨ TypeORM æ“ä½œ PostgreSQL æ•°æ®åº“

3. **é€šä¿¡æ–¹å¼**ï¼š
   - GraphQL over HTTP
   - å•ä¸€ç«¯ç‚¹ï¼š`/graphql`
   - Apollo Client â†” Apollo Server

4. **ç”Ÿäº§éƒ¨ç½²**ï¼š
   - Nginx åå‘ä»£ç†ï¼ˆç»Ÿä¸€å…¥å£ï¼‰
   - Docker Compose ç¼–æ’å¤šä¸ªå®¹å™¨
   - å®¹å™¨é—´é€šè¿‡ Docker ç½‘ç»œé€šä¿¡

---

**æœ¬æ–‡æ¡£å®Œæ•´è®°å½•äº†é¡¹ç›®ä»ç”¨æˆ·è®¿é—® URL åˆ°é¡µé¢æ˜¾ç¤ºã€æ•°æ®äº¤äº’çš„å…¨æµç¨‹ã€‚** ğŸ‰
